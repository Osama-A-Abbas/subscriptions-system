{% extends 'base.html' %} {% block title %}Add Subscription - Subscription
Manager{% endblock %} {% block content %}
<div class="row justify-content-center">
  <div class="col-md-8 col-lg-6">
    <div class="card shadow">
      <div class="card-header bg-primary text-white">
        <h4><i class="fas fa-plus me-2"></i>Add New Subscription</h4>
      </div>
      <div class="card-body">
        <form method="post">
          {% csrf_token %}
          <div class="row">
            <div class="col-md-12 mb-3">
              <label for="{{ form.name.id_for_label }}" class="form-label"
                >{{ form.name.label }}</label
              >
              {{ form.name }} {% if form.name.errors %}
              <div class="text-danger small">{{ form.name.errors.0 }}</div>
              {% endif %}
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label
                for="{{ form.monthly_cost.id_for_label }}"
                class="form-label"
                >{{ form.monthly_cost.label }}</label
              >
              {{ form.monthly_cost }} {% if form.monthly_cost.errors %}
              <div class="text-danger small">
                {{ form.monthly_cost.errors.0 }}
              </div>
              {% endif %}
            </div>
            <div class="col-md-6 mb-3">
              <label
                for="{{ form.yearly_cost.id_for_label }}"
                class="form-label"
                >{{ form.yearly_cost.label }}</label
              >
              {{ form.yearly_cost }} {% if form.yearly_cost.errors %}
              <div class="text-danger small">
                {{ form.yearly_cost.errors.0 }}
              </div>
              {% endif %}
            </div>
          </div>

          <div class="row">
            <div class="col-md-6 mb-3">
              <label
                for="{{ form.billing_cycle.id_for_label }}"
                class="form-label"
                >{{ form.billing_cycle.label }}</label
              >
              {{ form.billing_cycle }} {% if form.billing_cycle.errors %}
              <div class="text-danger small">
                {{ form.billing_cycle.errors.0 }}
              </div>
              {% endif %}
            </div>
            <div class="col-md-6 mb-3">
              <label for="{{ form.start_date.id_for_label }}" class="form-label"
                >{{ form.start_date.label }}</label
              >
              {{ form.start_date }} {% if form.start_date.errors %}
              <div class="text-danger small">
                {{ form.start_date.errors.0 }}
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Duration Fields -->
          <div class="row">
            <div
              class="col-md-6 mb-3"
              id="duration-months-field"
              style="display: none"
            >
              <label
                for="{{ form.duration_months.id_for_label }}"
                class="form-label"
                >{{ form.duration_months.label }}</label
              >
              {{ form.duration_months }} {% if form.duration_months.errors %}
              <div class="text-danger small">
                {{ form.duration_months.errors.0 }}
              </div>
              {% endif %}
              <div class="form-text">
                How many months will this subscription last?
              </div>
            </div>
            <div
              class="col-md-6 mb-3"
              id="duration-years-field"
              style="display: none"
            >
              <label
                for="{{ form.duration_years.id_for_label }}"
                class="form-label"
                >{{ form.duration_years.label }}</label
              >
              {{ form.duration_years }} {% if form.duration_years.errors %}
              <div class="text-danger small">
                {{ form.duration_years.errors.0 }}
              </div>
              {% endif %}
              <div class="form-text">
                How many years will this subscription last?
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 mb-3">
              <div class="form-check">
                {{ form.auto_renewal }}
                <label
                  class="form-check-label"
                  for="{{ form.auto_renewal.id_for_label }}"
                >
                  {{ form.auto_renewal.label }}
                </label>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12 mb-3">
              <label for="{{ form.category.id_for_label }}" class="form-label"
                >{{ form.category.label }}</label
              >
              {{ form.category }} {% if form.category.errors %}
              <div class="text-danger small">{{ form.category.errors.0 }}</div>
              {% endif %}
            </div>
          </div>

          <div class="d-grid gap-2 d-md-flex justify-content-md-end">
            <a
              href="{% url 'subscription_list' %}"
              class="btn btn-secondary me-md-2"
              >Cancel</a
            >
            <button type="submit" class="btn btn-primary">
              <i class="fas fa-save me-1"></i>Add Subscription
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const billingCycleSelect = document.getElementById(
      "{{ form.billing_cycle.id_for_label }}"
    );
    const durationMonthsField = document.getElementById(
      "duration-months-field"
    );
    const durationYearsField = document.getElementById("duration-years-field");

    function toggleDurationFields() {
      const selectedValue = billingCycleSelect.value;

      if (selectedValue === "monthly") {
        durationMonthsField.style.display = "block";
        durationYearsField.style.display = "none";
        // Clear yearly duration when switching to monthly
        const dy = document.getElementById(
          "{{ form.duration_years.id_for_label }}"
        );
        if (dy) {
          dy.value = "";
        }
      } else if (selectedValue === "yearly") {
        durationMonthsField.style.display = "none";
        durationYearsField.style.display = "block";
        // Clear monthly duration when switching to yearly
        const dm = document.getElementById(
          "{{ form.duration_months.id_for_label }}"
        );
        if (dm) {
          dm.value = "";
        }
      } else {
        durationMonthsField.style.display = "none";
        durationYearsField.style.display = "none";
      }
    }

    // Initial call to set the correct field visibility
    toggleDurationFields();

    // Listen for changes to billing cycle
    billingCycleSelect.addEventListener("change", toggleDurationFields);
  });
</script>
{% endblock %}
